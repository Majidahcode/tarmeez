<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>soicl midea</title>
    <link rel="stylesheet" href="style.css">
    <link
      rel="stylesheet"
      href="/node_modules/bootstrap/dist/css/bootstrap.min.css"
    />
    <script src="/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="/node_modules/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <!-- <div class="mainLOADER">
      <div class="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
    </div> -->
    <!-- <div id="loader"  style="background: rgba(128, 128, 128, 0.495); position: fixed; top: 0px; bottom: 0px; left: 0px; right: 0px; margin: auto auto; display: flex; justify-content: center; align-items: center; z-index: 9999; width: 100px; height: 100px; border-radius: 20px;">
      <div class="lds-roller">
          <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
      </div> -->
  <!-- </div> -->
    <!-- ========ALERT======= -->
    <div
      id="AlertPlaceholder"
      class="show fade"
      style="position: fixed; z-index: 9999; width: 30%; bottom: 0; right: 0"
    ></div>
    <!-- <button type="button" class="btn btn-primary" id="liveAlertBtn">Show live alert</button> -->

    <!-- ========ALERT======= -->

    <!-- ===========MODAL LOGIN========= -->
    <div
      class="modal  fade modelcss"
      id="loginModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content containerLoginctmb">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">
              تسجيل الدخول
            </h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="recipient-name" class="col-form-label"
                  >اسم المستخدم</label
                >
                <input
                  id="input1"
                  type="text"
                  class="form-control"
                  value="majidah"
                />
              </div>
              <div class="mb-3">
                <label for="message-text" class="col-form-label"
                  >كلمة السر</label
                >
                <input
                  id="input2"
                  class="form-control input"
                  type="password"
                  value="123456"
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn loginlog  loginlogClose"
              data-bs-dismiss="modal"
            >
              خروج
            </button>
            <button
              type="button"
              class="btn loginlog"
              onclick="loginbuttonclick()"
            >
              تسجيل الدخول
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- ===========MODAL LOGIN========= -->


    
    <!-- ===========MODAL REGESTER========= -->
    <div
      class="modal fade modelcss"
      id="regesterModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content ">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">
              تسجيل الدخول
            </h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="recipient-name" class="col-form-label">Profile Image:</label>
                <input type="file" class="form-control" id="register-image-input" value="Yarob99">
              </div>
              <div class="mb-3">
                <label for="recipient-name" class="col-form-label"
                  >الاسم </label
                >
                <input
                  id="regesterNameInput"
                  type="text"
                  class="form-control"
                  value="majidah"
                />
              </div>
              <div class="mb-3">
                <label for="recipient-name" class="col-form-label"
                  >اسم المستخدم</label
                >
                <input
                  id="regesterUserNameInput"
                  type="text"
                  class="form-control"
                  value="majidah"
                />
              </div>
              <div class="mb-3">
                <label for="message-text" class="col-form-label"
                  >كلمة السر</label
                >
                <input
                  id="regesterPassInput2"
                  class="form-control input"
                  type="password"
                  value="123456"
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn loginlog  loginlogClose"
              data-bs-dismiss="modal"
            >
              خروج
            </button>
            <button
              type="button"
              class="btn loginlog"
              onclick="regesterbuttonclick()"
            >
              تسجيل  
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- ===========MODAL REGESTER========= -->


    
    <!-- ===========MODAL ADD POST BUTTON========= -->
    <div
      class="modal  fade modelcss"
      id="addPodtModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content containerLoginctmb">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">
              اضافه منشور
            </h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="recipient-name" class="col-form-label"
                  > العنوان</label
                >
                <input
                  id="add-title-input"
                  type="text"
                  class="form-control"
                  value="فلسفه"
                />
              </div>
              <div class="mb-3">
                <label for="message-text" class="col-form-label"
                  > الرساله</label
                >
                <textarea  id="add-post-input" class="form-control input" name="" id="" style="resize: none;" >...اكتب ما تشعر به</textarea>
              </div>
            </form>
            <div>
            <label for="recipient-name" class="col-form-label"
              > الصوره</label
            >
            <input
              id="add-image-input"
              type="file"
              class="form-control" 
            
            />
          </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn loginlog  loginlogClose"
              data-bs-dismiss="modal"
            >
              خروج
            </button>
            <button
              type="button"
              class="btn loginlog"
              onclick="AddPostButton()"
            >
              نشر 
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- ===========MODAL ADD POST BUTTON========= -->

    <!--ADD POST BUTTON -->
    <div class="add-post-button" id="add-post-button"   data-bs-toggle="modal"
        data-bs-target="#addPodtModal">
      <span>+</span>
    </div>
    <!--=======ADD POST BUTTON ========-->
    <div class="Post-Username" id="Post-Username-Div" ><span id="Post-Username"></span> Post</div>
    <div id="sidebar" class="sidebar">
      <div class="header-sidebar">
        <img id="sidebar-image" src="" alt="" />
        <br />
        <b id="sidebar-username">@Yarob</b>
        <h6 id="sidebar-email" >Yarob13@gmail.com</h6>
        <div class="shodw-box">
          <h6>058718784</h6>
          <h6>Male</h6>
          <h6>saudi aribya</h6>
          <h6>riyadh</h6>
          <h6>Software Engneer</h6>
          <h6>5 year Expireienc</h6>
        </div>
      </div>
    </div>
    <div class="content-side">
      <div class="links">
        <a href="#">اضافه </a>
        <div class="one"></div>

        <a href="#">منشوراتي </a>
        <div class="one"></div>

        <a href="#">منشورات اعجبتني </a>
        <div class="one"></div>

        <a href="#">المشاهده لاحقا </a>
      </div>
    </div>
    <!--=== NON_LOGGED IN USER ===-->
    <div class="buttons">
      <a
        id="loginBtn"
        class="login"
        data-bs-toggle="modal"
        data-bs-target="#loginModal"
        >Login</a
      >
      <br />
      <a id="regesterBtn" class="regs" data-bs-toggle="modal"   data-bs-target="#regesterModal">Regester</a>
    </div>
    <!-- ====NON_LOGGED IN USER=== -->

    <!-- ====FOR LOGGED IN USER=== -->
    <div class="buttons">
      <button
        onclick="logout()"
        id="logOutBtn"
        class="login btn logout btn-outlin-danger mx2 mt-5"
        data-bs-toggle="modal"
      >
        logout
      </button>
    </div>
    <!-- ====FOR LOGGED IN USER=== -->

    <header class="header">
      <a class="logo" href="/home.html">Tarmeez</a>
      <nav class="navbar">
        <a href="/home.html">Home</a>
        <a href="" onclick="profileClicked()">Profile</a>
        <a href="#">Your Friends</a>
        <a href="#">Serche</a>
      </nav>
    </header>
    <div class="container" id="container">
      <div class="card" id="post" style="cursor: pointer;">
        <!-- <div class="header-card">
          <img src="./iconImage/avatar-03.png" alt="">
          <b>hhhh</b>
        </div>
        <div class="content">
          <img src="./postImage/51.jpg" alt="">
          <h6>hhhhhhhhhhh</h6>
          <h4>wwwwwwwwwwwww</h4>
          <p>
          useigvis
          </p>
          <hr />
          <div class="end-card">
            <span class="pen"></span>
            <span class="comment"></span>
          </div>
        </div> -->
      </div>  
        <!-- CMMENT -->
    <div class="containerComment" id="commments">
      
    
    </div>
    <!-- CMMENT -->
    </div>
  
  
    <!-- CMMENT -->

  </body>
  <script src="./mainLogic.js"></script>
  <script>
    setupUI()
    //loginbuttonclick()

    //function cardClick(){
    //  window.location = `home.html`
  //  }


    const urlParams = new URLSearchParams(window.location.search)
    const id = urlParams.get("postId")
    
    getPost()
    function getPost() {
      axios.get(`${baseURL}/posts/${id}`)
      .then((response) =>{
        //console.log(response.data)
        const data = response.data
        const post = data.data
        const comments = post.comments

        fillPost(post)
        fillComments(comments)
        
      })
      
    }

    function fillPost(post){
      document.getElementById("post").innerHTML = ""
      const author = post.author
      const content = 
      `
      <div class="card"  style="cursor: pointer;">
        <div class="header-card">
          <img src=" ${post.author.porfile_image}" alt="">
          <b> ${post.author.username} </b>
        </div>
        <div class="content" >
          <img src="${post.image}" alt="">
          <h6> ${post.title} </h6>
          <h4>${post.body}</h4>
          <p>
          useigvis
          </p>
          <hr />
          <div class="end-card">
            <span class="pen"></span>
          <span class="comment">Comment ( ${post.comments_count})</span>
          </div>
          <div class="comments">
          </div>
        </div>
        
        <div class="input-group mb-3 mx-1"  id="add-comment-div">
        <input id="comment-input" type="text" placeholder="add your comment here.." class="form-control" >
        <button class="btn btn-outline-primary mx-1" type="button" onclick="addCommentButtonClick()">send</button>
        </div>
      </div> 
      `
      document.getElementById("post").innerHTML = content
      document.getElementById("Post-Username").innerHTML = author.username


    }

    function fillComments(comments){
      const commentsDiv = document.getElementById("commments")
      commentsDiv.innerHTML = ""
      comments.forEach(comment => {
        console.log(comment)
        const content = 
        `
            <!-- CMMENT -->
            <div class="content comments" id="commments">
              <div>
                <!-- PROFILE + USERNAMAE -->
                <div class="profileUsername">
                  <img src="${comment.author.porfile_image}" alt="">
                  <b>${comment.author.username}</b>
                </div>
                <!-- PROFILE + USERNAMAE -->
                <!-- COMMENTS BODY -->
                <div>
                  ${comment.body}
                </div>
                <!-- COMMENTS BODY -->
              </div>
          
            </div>
            <!-- CMMENT -->
        `
        commentsDiv.innerHTML += content
      })
    }

    function addCommentButtonClick(){
      let comment_input = document.getElementById("comment-input").value
      let params = {
        "body": comment_input
      }
      let token = localStorage.getItem("token")
      url = `${baseURL}/posts/${id}/comments`
      axios.post(url, params , {
        headers:{
          "authorization": `Bearer ${token}`
        }
      
      })
      .then((response) =>{
        showAlert(" تمت اضافه تعليقك بنجاح", "success");
        getPost()
      })
      .catch((error) =>{
        let errorMessage = error.response.data.message
      showAlert(errorMessage, "danger");

      })

      
    }

  </script>

</html>
